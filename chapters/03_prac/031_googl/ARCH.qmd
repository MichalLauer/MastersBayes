All the models assume shocks distributed with Student's distribution with parameter $\nu$. This is because
financial time series data often assume heavy tails and in Figure @tbl-googl-logret supports this. It is assumed that 

$$
\nu \sim \Gamma(\alpha = 4, \beta = 3).
$$

This implies that it is expected, before observing data, that the constant volatility is between $4.23$ and $22.83$ with
probability $0.89$. The expected volatility is 12. The full distribution is shown in Figure @fig-googl-arch-apr-nu.

![GOOGL: Apriori distribution for $\nu$](./img/googl/arch/apriori_nu.png){#fig-googl-arch-apr-nu}

Since models work with log returns, the expected log return at time $t$ is zero and only variance is modeled. Constant
volatility $\alpha_0$ and all parameters $\alpha_i$ are modeled using Gamma distribution. The apriori distribution
for all parameters $\alpha$ is

$$
\alpha_i \sim \Gamma(\alpha = 2, \beta = 0.4),
$$

which implies 89% credibility interval of $(0.15, 1.85)$ with the expectation of 0.8. Apriori distribution is displayed on Figure @fig-googl-apr-alpha

![GOOGL: Apriori distribution for $\alpha_i$](./img/googl/arch/apriori_alpha.png){#fig-googl-apr-alpha}

In order to achieve stationary and stable models, $\sum_{i=1}^m a_i < 1$ must hold. To uphold this restriction, a transformation
is applied such

$$
\alpha_{tr} = \alpha_i / (1 + \sum_{i=1}^m a_i).
$$

New parameters $\alpha_{\text{tr}}$ are constrained and their posterior distribution is further explored. Since the expected
value of log returns is zero, the mean function is zero and residuals are just lagged variables. The whole model could be 
written as

$$
\begin{aligned}
y_t &\sim \sigma_t \epsilon_t \\
\epsilon_t &\sim T(\nu) \\
\nu &\sim \Gamma(\alpha = 4, \beta = 3) \\
\sigma_t &= \alpha_0 + \sum_{i=1}^m \alpha_{i, \text{tr}} a^2_{t - i + 1} \\
\alpha_{i, \text{tr}} &= \alpha_i / (1 + \sum_{i=1}^m a_i) \\
\alpha_i &\sim \Gamma(\alpha = 2, \beta = 0.4)
\end{aligned}
$$

In total, 8 models have been created, ranging from ARCH$(1)$ up to ARCH$(8)$. Stan used 4 chains with 8 000 iterations where
the first 2 000 are used as a warmup. Stan uses the NUTS sampler by default and the estimation took about 20
minutes. First,
the convergence statistics need to be checked. The shrinkage factors for all parameters and models are displayed
in Table @tbl-googl-arch-shrinkage.

Table: GOOGL/ARCH: Shrinkage factors {#tbl-googl-arch-shrinkage}

|param    |     m = 1|    m = 2|     m = 3|     m = 4|     m = 5|     m = 6|     m = 7|     m = 8|
|:--------|---------:|--------:|---------:|---------:|---------:|---------:|---------:|---------:|
|nu       | 0.9999795| 1.000020| 0.9999963| 0.9999809| 0.9999761| 1.0000207| 1.0002824| 1.0001182|
|alpha0   | 1.0000011| 1.000455| 1.0000035| 1.0001660| 1.0000176| 1.0002472| 0.9999996| 1.0002270|
|alpha[1] | 1.0000145| 1.000025| 1.0000755| 1.0000433| 1.0001216| 0.9999619| 0.9999451| 1.0000257|
|alpha[2] |         -| 1.000363| 0.9998719| 0.9998873| 0.9999869| 0.9999940| 1.0002198| 1.0000188|
|alpha[3] |         -|        -| 1.0001850| 0.9998991| 0.9999923| 1.0000203| 0.9998670| 0.9999355|
|alpha[4] |         -|        -|         -| 1.0000887| 1.0000096| 0.9999479| 0.9999747| 1.0000356|
|alpha[5] |         -|        -|         -|         -| 0.9999887| 0.9999055| 0.9999959| 0.9999024|
|alpha[6] |         -|        -|         -|         -|         -| 0.9999598| 1.0000171| 0.9998547|
|alpha[7] |         -|        -|         -|         -|         -|         -| 0.9999118| 1.0001123|
|alpha[8] |         -|        -|         -|         -|         -|         -|         -| 1.0001808|

It is apparent that not a single shrinkage factor is greater than 1.1 and this suggest satisfactory congergence. Another look
can be through the ESS in Table @tbl-googl-arch-ess.

Table: GOOGL/ARCH: ESS {#tbl-googl-arch-ess}

|param    |    m = 1|    m = 2|    m = 3|    m = 4|    m = 5|    m = 6|    m = 7|     m = 8|
|:--------|--------:|--------:|--------:|--------:|--------:|--------:|--------:|---------:|
|nu       | 12717.50| 15420.02| 18189.37| 17883.54| 18480.97| 21167.19| 17648.30| 14272.295|
|alpha0   | 13420.03| 15400.38| 17031.99| 15569.39| 14807.16| 14493.73| 12223.77|  9910.834|
|alpha[1] | 15439.66| 21306.78| 23513.12| 25718.58| 24870.72| 25945.86| 24316.50| 28775.310|
|alpha[2] |        -| 18861.07| 23009.87| 22658.24| 25297.43| 25270.00| 21517.95| 21999.776|
|alpha[3] |        -|        -| 25901.63| 26253.86| 26349.03| 27308.27| 25713.43| 26985.128|
|alpha[4] |        -|        -|        -| 26309.30| 27167.88| 31781.63| 26744.20| 30589.796|
|alpha[5] |        -|        -|        -|        -| 23642.57| 26416.92| 22945.19| 26818.564|
|alpha[6] |        -|        -|        -|        -|        -| 29909.69| 25984.31| 29242.314|
|alpha[7] |        -|        -|        -|        -|        -|        -| 26326.07| 26166.691|
|alpha[8] |        -|        -|        -|        -|        -|        -|        -| 18843.680|

In total, $4 * 6000 = 24000$ samples are considered during inference. Simple models have relatively smaller
ESS, which might suggest inefficient sampling. All parameters across all models have ESS greater than 9 000
and thus the inference should reliably describe the posterior distribution.

Since all models assume to be shock distributed with Students distribution, the parameter $\nu$ is of interest. Figure 
@fig-googl-arch-post-nu shows all posterior distribution by model.

![GOOGL/ARCH: Posterior distribution for $\nu$](./img/googl/arch/posterior_nu.png){#fig-googl-arch-post-nu}

All posterior distributions look very similar and their central tendencies are desribed in Table @tbl-googl-arch-post-nu.

Table: GOOGL/ARCH: Tabular description of posterior for $\nu$ {#tbl-googl-arch-post-nu}

|Arch(m)  |m = 1 |m = 2 |m = 3 |m = 4 |m = 5 |m = 6 |m = 7 |m = 8 |
|:--------|:-----|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|Average  |6.16  |6.47  |6.40  |6.40  |6.42  |6.60  |6.70  |8.11  |
|SD       |1.26  |1.38  |1.34  |1.34  |1.34  |1.35  |1.41  |1.99  |
|CI_lower |4.50  |4.66  |4.63  |4.62  |4.66  |4.80  |4.85  |5.57  |
|CI_upper |8.34  |8.92  |8.80  |8.75  |8.79  |9.01  |9.19  |11.59 |

All posterios but the model with lag $m=8$ expect around 6 - 7 degrees of freedom. Model
8 is an outlier with expected 8 degrees of freedom. The posterior of all models overlaps 
which may suggest that the degrees of freedom is similar in all models. The 89% credibility
interval is very similar for models 1 through 7 and it's higher for model 8. These results
suggest that the volatility of GOOGL ticker has heavy tails and is not normally distributed.
All models have most probably finite variance.

Another estimated parameter is the instantinuous volatility $\alpha_0$, whose posteriors throughout all models is 
shown in Figure @fig-googl-arch-post-alpha0.

![GOOGl/ARCH: Posterior distribution for $\alpha_0$](./img/googl/arch/posterior_alpha0.png){#fig-googl-arch-post-alpha0}

All the posterios look similar but as the order of the model increases, the less 
instantinuous volatility is expected. This makes sense, because additional lags explain more
volatility and less weight to the instantinuous volatility is assigned. Looking at it's central
tendency, the expected instantinuous volatility does not change by a large magnitude. 
This is furhter examined in Table @tbl-googl-arch-post-alpha0.

Table: GOOGL/ARCH: Tabular description of posterior for $\alpha_0$ {#tbl-googl-arch-post-alpha0}

|Arch(m)  |m = 1  |m = 2  |m = 3  |m = 4  |m = 5  |m = 6  |m = 7  |m = 8  |
|:--------|:------|:------|:------|:------|:------|:------|:------|:------|
|Average  |0.0002 |0.0002 |0.0002 |0.0002 |0.0002 |0.0001 |0.0001 |0.0001 |
|SD       |0.0000 |0.0000 |0.0000 |0.0000 |0.0000 |0.0000 |0.0000 |0.0000 |
|CI_lower |0.0002 |0.0002 |0.0002 |0.0001 |0.0001 |0.0001 |0.0001 |0.0001 |
|CI_upper |0.0002 |0.0002 |0.0002 |0.0002 |0.0002 |0.0001 |0.0001 |0.0001 |

Even though the posterior distributions look different, the magnitude of such difference
is very small and can be observed only on the fourth decimal place. Difference between
models can be observed, but it's magnitude probably does not have any valuable effect on 
the final volatility.

The (constrained) posterior distributions for coefficients $\alpha_1$ are shown in @fig-googl-arch-post-alpha1tr.

![GOOGl/ARCH: Posterior distribution for $\alpha_{1, \text{tr}}$](./img/googl/arch/posterior_alpha1tr.png){#fig-googl-arch-post-alpha1tr}

The posterior distributions for models 1 through look again very similarly. Model
8 has fatter tail and puts slightly more probability on higher effect of first lag.
Posterior description is provided in Table @tbl-googl-arch-post-alpha1tr

Table: GOOGL/ARCH: Tabular description of posterior for $\alpha_{1, \text{tr}}$ {#tbl-googl-arch-post-alpha1tr}

|Arch(m)  |m = 1 |m = 2 |m = 3 |m = 4 |m = 5 |m = 6 |m = 7 |m = 8 |
|:--------|:-----|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|Average  |0.07  |0.08  |0.07  |0.08  |0.08  |0.08  |0.08  |0.09  |
|SD       |0.03  |0.03  |0.03  |0.04  |0.04  |0.04  |0.04  |0.04  |
|CI_lower |0.03  |0.03  |0.03  |0.03  |0.03  |0.03  |0.03  |0.04  |
|CI_upper |0.13  |0.14  |0.14  |0.14  |0.15  |0.15  |0.15  |0.17  |

The expected effect of the first lag is increasing, but the lower bound of credibility intervals
looks very similar. The upper bound is increasing, which might suggest that more complex models
put more probability on bigger efect of the first lag. The posterior distributions are very
close and no large difference can be observed. The same thing can be observed on other parameters in Figure @fig-googl-arch-post-alpha-itr.

![GOOGl/ARCH: Posterior distribution for $\alpha_{i, \text{tr}}$](./img/googl/arch/posterior_alpha_i.png){#fig-googl-arch-post-alpha-itr}

Coefficient $\alpha_{2, \text{tr}}$ exhibits the same properties as $\alpha_{1, \text{tr}}$ meaning the posterior distributions are all very close to each other, with a single exception
of the eith model. After order $m = 3$, the effect of lagged coefficients stabilizes and the
posterior distributions do not differ much. This is further supported by the posterior
expectations in Table @tbl-googl-arch-post-alpha-itr.

Table: GOOGL/ARCH: Expected $\alpha_{i, \text{tr}$ for all models {#tbl-googl-arch-post-alpha-itr}

|coeff |m = 1 |m = 2 |m = 3 |m = 4 |m = 5 |m = 6 |m = 7 |m = 8 |
|:-----|:-----|:-----|:-----|:-----|:-----|:-----|:-----|:-----|
|i = 1 |0.07  |0.08  |0.07  |0.08  |0.08  |0.08  |0.08  |0.09  |
|i = 2 |-     |0.06  |0.07  |0.07  |0.07  |0.07  |0.08  |0.10  |
|i = 3 |-     |-     |0.06  |0.06  |0.06  |0.06  |0.06  |0.06  |
|i = 4 |-     |-     |-     |0.04  |0.04  |0.04  |0.04  |0.04  |
|i = 5 |-     |-     |-     |-     |0.09  |0.08  |0.08  |0.09  |
|i = 6 |-     |-     |-     |-     |-     |0.09  |0.10  |0.09  |
|i = 7 |-     |-     |-     |-     |-     |-     |0.04  |0.05  |
|i = 8 |-     |-     |-     |-     |-     |-     |-     |0.15  |

Looking left-to-right, the coefficients do not differ by a large magnitude. This means
that all models attribute simmilar weights to lagged squared residuals. Every column
represents a single model. Dashes imply that the coefficient is not present for a particular
model. ARCH$(m = 1)$ can have only $\alpha_1$, model ARCH$(m = 2)$ only $\alpha_1, \alpha_2$ and so on. Finally, a perspective on the estimated volatility is in Figure 
@fig-googl-arch-post-volatility.

![GOOGl/ARCH: Estimated volatility across all models.](./img/googl/arch/posterior_volatility.png){#fig-googl-arch-post-volatility}

The volatility in ARCH$(1)$ is very static and react to the previous log return. This mens that
the models does not work with a long memory and react primarily to the last observed shock.
On the other hand, ARCH$(8)$ is very variable and a single shock has relatively high effect
on future forecasted volatility. 